<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Floating Chatbot (Icon only)</title>
    <style>
      :root {
        --accent: #2563eb;
        --bg: #fff;
        --muted: #6b7280;
        --shadow: 0 10px 25px rgba(2, 6, 23, 0.2);
        font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI",
          Roboto, "Helvetica Neue", Arial;
      }

      /* Icon button */
      .chat-toggle {
        position: fixed;
        right: 20px;
        bottom: 20px;
        width: 64px;
        height: 64px;
        border-radius: 999px;
        display: inline-grid;
        place-items: center;
        box-shadow: var(--shadow);
        background: linear-gradient(180deg, var(--accent), #1e40af);
        border: none;
        cursor: pointer;
        z-index: 9999;
        transition: transform 0.12s ease, box-shadow 0.12s ease;
      }
      .chat-toggle:active {
        transform: scale(0.96);
      }
      .chat-toggle:focus {
        outline: 3px solid rgba(37, 99, 235, 0.18);
      }

      .chat-toggle svg {
        width: 28px;
        height: 28px;
        fill: white;
      }

      /* Chat panel */
      .chat-panel {
        position: fixed;
        right: 20px;
        bottom: 96px; /* sits above the icon */
        width: 360px;
        max-width: calc(100vw - 40px);
        height: 520px;
        max-height: 80vh;
        border-radius: 12px;
        background: var(--bg);
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        transform-origin: right bottom;
        z-index: 9998;
        opacity: 0;
        pointer-events: none;
        transform: translateY(10px) scale(0.98);
        transition: opacity 0.18s ease, transform 0.18s ease;
      }
      .chat-panel.open {
        opacity: 1;
        pointer-events: auto;
        transform: translateY(0) scale(1);
      }

      .chat-header {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 14px;
        border-bottom: 1px solid #eef2ff;
        background: linear-gradient(180deg, #f8fbff, #fff);
      }
      .chat-header .title {
        font-weight: 600;
      }
      .chat-header .subtitle {
        font-size: 12px;
        color: var(--muted);
      }
      .chat-close {
        margin-left: auto;
        background: none;
        border: none;
        padding: 6px;
        border-radius: 8px;
        cursor: pointer;
      }
      .chat-close:focus {
        outline: 3px solid rgba(37, 99, 235, 0.12);
      }

      .messages {
        padding: 12px;
        flex: 1;
        overflow: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
        background: linear-gradient(180deg, #fff, #fbfdff);
      }

      .msg {
        max-width: 78%;
        padding: 10px 12px;
        border-radius: 12px;
        line-height: 1.3;
      }
      .msg.user {
        align-self: flex-end;
        background: #2563eb;
        color: white;
        border-bottom-right-radius: 6px;
      }
      .msg.bot {
        align-self: flex-start;
        background: #f1f5f9;
        color: #0f172a;
        border-bottom-left-radius: 6px;
      }

      .composer {
        display: flex;
        padding: 10px;
        border-top: 1px solid #eef2ff;
        gap: 8px;
      }
      .composer input {
        flex: 1;
        padding: 10px 12px;
        border-radius: 10px;
        border: 1px solid #e6eefc;
        font-size: 14px;
      }
      .composer button {
        background: var(--accent);
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 10px;
        cursor: pointer;
      }
      .composer button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* small-screen tweaks */
      @media (max-width: 420px) {
        .chat-panel {
          width: 94vw;
          right: 3%;
          bottom: 86px;
          height: 70vh;
        }
        .chat-toggle {
          right: 10px;
          bottom: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Chat icon (only visible element initially) -->
    <button
      class="chat-toggle"
      id="chatToggle"
      aria-expanded="false"
      aria-label="Open chat"
    >
      <!-- simple robot/chat SVG icon -->
      <svg viewBox="0 0 24 24" aria-hidden="true">
        <path
          d="M12 2a3 3 0 0 0-3 3v1H7a3 3 0 0 0-3 3v4a4 4 0 0 0 4 4h8a4 4 0 0 0 4-4v-4a3 3 0 0 0-3-3h-2V5a3 3 0 0 0-3-3zm-4 9a1 1 0 1 1 0-2 1 1 0 0 1 0 2zm8 0a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
        />
      </svg>
    </button>

    <!-- Chat panel (hidden until toggle) -->
    <aside
      class="chat-panel"
      id="chatPanel"
      aria-hidden="true"
      role="dialog"
      aria-label="Chat with us"
    >
      <div class="chat-header">
        <div style="display: flex; flex-direction: column">
          <span class="title">Chat with us</span>
          <span class="subtitle">Click the icon to open/close</span>
        </div>
        <button class="chat-close" id="chatClose" aria-label="Close chat">
          ✕
        </button>
      </div>

      <div class="messages" id="messages" aria-live="polite"></div>

      <form class="composer" id="composer">
        <input
          id="inputMsg"
          autocomplete="off"
          placeholder="Type a message..."
          aria-label="Type a message"
        />
        <button id="sendBtn" type="submit">Send</button>
      </form>
    </aside>

    <script>
      const chatToggle = document.getElementById("chatToggle")
      const chatPanel = document.getElementById("chatPanel")
      const chatClose = document.getElementById("chatClose")
      const messagesEl = document.getElementById("messages")
      const composer = document.getElementById("composer")
      const inputMsg = document.getElementById("inputMsg")

      function openChat() {
        chatPanel.classList.add("open")
        chatPanel.setAttribute("aria-hidden", "false")
        chatToggle.setAttribute("aria-expanded", "true")
        inputMsg.focus()
      }
      function closeChat() {
        chatPanel.classList.remove("open")
        chatPanel.setAttribute("aria-hidden", "true")
        chatToggle.setAttribute("aria-expanded", "false")
        chatToggle.focus()
      }

      chatToggle.addEventListener("click", () => {
        const isOpen = chatPanel.classList.contains("open")
        if (isOpen) closeChat()
        else openChat()
      })
      chatClose.addEventListener("click", closeChat)

      // close with Esc
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape" && chatPanel.classList.contains("open"))
          closeChat()
      })

      // simple helper to append message
      function appendMessage(text, who = "bot") {
        const d = document.createElement("div")
        d.className = "msg " + (who === "user" ? "user" : "bot")
        d.textContent = text
        messagesEl.appendChild(d)
        messagesEl.scrollTop = messagesEl.scrollHeight
      }

      // Placeholder bot connector - replace this with your real bot API call
      async function sendMessageToBot(text) {
        // Example: call your backend API
        // const resp = await fetch('/api/chat', {method:'POST', body: JSON.stringify({message:text})});
        // const data = await resp.json();
        // return data.reply;

        // Temporary demo behaviour: echo with small delay
        await new Promise((r) => setTimeout(r, 650))
        return "Echo: " + text
      }

      composer.addEventListener("submit", async (e) => {
        e.preventDefault()
        const text = inputMsg.value.trim()
        if (!text) return
        inputMsg.value = ""
        appendMessage(text, "user")
        // optimistic UI: show "typing" indicator
        const typing = document.createElement("div")
        typing.className = "msg bot"
        typing.textContent = "Typing..."
        messagesEl.appendChild(typing)
        messagesEl.scrollTop = messagesEl.scrollHeight

        try {
          const reply = await sendMessageToBot(text)
          typing.remove()
          appendMessage(reply, "bot")
        } catch (err) {
          typing.textContent = "Sorry — something went wrong."
          console.error(err)
        }
      })

      // optional: open chat automatically if query param ?chat=1 is present
      if (new URLSearchParams(location.search).get("chat") === "1") openChat()
    </script>
  </body>
</html>
